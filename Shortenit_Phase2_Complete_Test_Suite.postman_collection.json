{
  "info": {
    "name": "Shortenit - Phase 2 Complete Test Suite",
    "description": "Complete test collection for Phase 2: URL Shortening, Analytics, and Pagination",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "version": "2.0.0"
  },
  "variable": [
    {
      "key": "base_url",
      "value": "http://localhost:8080",
      "type": "string"
    },
    {
      "key": "short_code",
      "value": "",
      "type": "string"
    },
    {
      "key": "custom_alias_code",
      "value": "",
      "type": "string"
    },
    {
      "key": "expired_code",
      "value": "",
      "type": "string"
    }
  ],
  "item": [
    {
      "name": "Phase 1 - URL Shortening",
      "item": [
        {
          "name": "1.1 Create URL - Basic",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 201 Created\", function () {",
                  "    pm.response.to.have.status(201);",
                  "});",
                  "",
                  "pm.test(\"Response has required fields\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('id');",
                  "    pm.expect(jsonData).to.have.property('shortCode');",
                  "    pm.expect(jsonData).to.have.property('originalUrl');",
                  "    pm.expect(jsonData).to.have.property('shortUrl');",
                  "    pm.expect(jsonData).to.have.property('createdAt');",
                  "    pm.expect(jsonData).to.have.property('clickCount');",
                  "});",
                  "",
                  "pm.test(\"Short code is 7 characters\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.shortCode).to.have.lengthOf(7);",
                  "});",
                  "",
                  "pm.test(\"Short URL contains /s/ prefix\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.shortUrl).to.include('/s/');",
                  "});",
                  "",
                  "pm.test(\"Click count is 0\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.clickCount).to.eql(0);",
                  "});",
                  "",
                  "// Save short code for later tests",
                  "pm.collectionVariables.set(\"short_code\", pm.response.json().shortCode);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"originalUrl\": \"https://google.com\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/shorten",
              "host": ["{{base_url}}"],
              "path": ["api", "shorten"]
            }
          }
        },
        {
          "name": "1.2 Create URL - Custom Alias",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 201\", function () {",
                  "    pm.response.to.have.status(201);",
                  "});",
                  "",
                  "pm.test(\"Custom alias is used\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.customAlias).to.eql('github-repo');",
                  "    pm.expect(jsonData.shortCode).to.eql('github-repo');",
                  "});",
                  "",
                  "pm.collectionVariables.set(\"custom_alias_code\", pm.response.json().shortCode);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"originalUrl\": \"https://github.com/your-repo\",\n  \"customAlias\": \"github-repo\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/shorten",
              "host": ["{{base_url}}"],
              "path": ["api", "shorten"]
            }
          }
        },
        {
          "name": "1.3 Create URL - With Expiration",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 201\", function () {",
                  "    pm.response.to.have.status(201);",
                  "});",
                  "",
                  "pm.test(\"Expiration date is set\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.expiresAt).to.not.be.null;",
                  "});",
                  "",
                  "pm.collectionVariables.set(\"expired_code\", pm.response.json().shortCode);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"originalUrl\": \"https://youtube.com\",\n  \"expirationDays\": 30\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/shorten",
              "host": ["{{base_url}}"],
              "path": ["api", "shorten"]
            }
          }
        },
        {
          "name": "1.4 Error - Duplicate Custom Alias",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 400 or 409\", function () {",
                  "    pm.expect(pm.response.code).to.be.oneOf([400, 409]);",
                  "});",
                  "",
                  "pm.test(\"Error message mentions duplicate\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.message.toLowerCase()).to.include('already exists');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"originalUrl\": \"https://example.com\",\n  \"customAlias\": \"github-repo\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/shorten",
              "host": ["{{base_url}}"],
              "path": ["api", "shorten"]
            }
          }
        },
        {
          "name": "1.5 Error - Invalid URL",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 400\", function () {",
                  "    pm.response.to.have.status(400);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"originalUrl\": \"not-a-valid-url\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/api/shorten",
              "host": ["{{base_url}}"],
              "path": ["api", "shorten"]
            }
          }
        },
        {
          "name": "1.6 Get URL Info",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"URL info is complete\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.shortCode).to.eql(pm.collectionVariables.get('short_code'));",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/urls/{{short_code}}",
              "host": ["{{base_url}}"],
              "path": ["api", "urls", "{{short_code}}"]
            }
          }
        },
        {
          "name": "1.7 Error - URL Not Found",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 404\", function () {",
                  "    pm.response.to.have.status(404);",
                  "});",
                  "",
                  "pm.test(\"Error message mentions not found\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.message.toLowerCase()).to.include('not found');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/urls/invalid999",
              "host": ["{{base_url}}"],
              "path": ["api", "urls", "invalid999"]
            }
          }
        },
        {
          "name": "1.8 Delete URL",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 204 No Content\", function () {",
                  "    pm.response.to.have.status(204);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "DELETE",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/urls/{{expired_code}}",
              "host": ["{{base_url}}"],
              "path": ["api", "urls", "{{expired_code}}"]
            }
          }
        }
      ]
    },
    {
      "name": "Phase 1 - Redirects",
      "item": [
        {
          "name": "2.1 Redirect - Valid Short Code",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 302 Found\", function () {",
                  "    pm.response.to.have.status(302);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/s/{{short_code}}",
              "host": ["{{base_url}}"],
              "path": ["s", "{{short_code}}"]
            }
          },
          "description": "Test redirect with /s/ prefix"
        },
        {
          "name": "2.2 Error - Invalid Short Code",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 404\", function () {",
                  "    pm.response.to.have.status(404);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/s/invalid999",
              "host": ["{{base_url}}"],
              "path": ["s", "invalid999"]
            }
          }
        }
      ]
    },
    {
      "name": "Phase 2 - Analytics",
      "item": [
        {
          "name": "3.1 Get Analytics - Basic",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Analytics has required fields\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('shortCode');",
                  "    pm.expect(jsonData).to.have.property('originalUrl');",
                  "    pm.expect(jsonData).to.have.property('totalClicks');",
                  "    pm.expect(jsonData).to.have.property('clicksByCountry');",
                  "    pm.expect(jsonData).to.have.property('clicksByDevice');",
                  "    pm.expect(jsonData).to.have.property('clicksByBrowser');",
                  "    pm.expect(jsonData).to.have.property('clicksByReferrer');",
                  "    pm.expect(jsonData).to.have.property('clicksOverTime');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/analytics/{{short_code}}",
              "host": ["{{base_url}}"],
              "path": ["api", "analytics", "{{short_code}}"]
            }
          }
        },
        {
          "name": "3.2 Get Analytics - Date Range",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Date range filter applied\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.clicksOverTime).to.be.an('array');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/analytics/{{short_code}}/range?startDate=2024-12-01T00:00:00&endDate=2024-12-31T23:59:59",
              "host": ["{{base_url}}"],
              "path": ["api", "analytics", "{{short_code}}", "range"],
              "query": [
                {
                  "key": "startDate",
                  "value": "2024-12-01T00:00:00"
                },
                {
                  "key": "endDate",
                  "value": "2024-12-31T23:59:59"
                }
              ]
            }
          }
        },
        {
          "name": "3.3 Analytics - Geographic Data",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Country data structure is correct\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.clicksByCountry).to.be.an('array');",
                  "    ",
                  "    if (jsonData.clicksByCountry.length > 0) {",
                  "        var country = jsonData.clicksByCountry[0];",
                  "        pm.expect(country).to.have.property('country');",
                  "        pm.expect(country).to.have.property('count');",
                  "    }",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/analytics/{{short_code}}",
              "host": ["{{base_url}}"],
              "path": ["api", "analytics", "{{short_code}}"]
            }
          }
        },
        {
          "name": "3.4 Analytics - Device Data",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Device data structure is correct\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.clicksByDevice).to.be.an('array');",
                  "    ",
                  "    if (jsonData.clicksByDevice.length > 0) {",
                  "        var device = jsonData.clicksByDevice[0];",
                  "        pm.expect(device).to.have.property('deviceType');",
                  "        pm.expect(device).to.have.property('count');",
                  "    }",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/analytics/{{short_code}}",
              "host": ["{{base_url}}"],
              "path": ["api", "analytics", "{{short_code}}"]
            }
          }
        },
        {
          "name": "3.5 Analytics - Browser Data",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Browser data structure is correct\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.clicksByBrowser).to.be.an('array');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/analytics/{{short_code}}",
              "host": ["{{base_url}}"],
              "path": ["api", "analytics", "{{short_code}}"]
            }
          }
        },
        {
          "name": "3.6 Analytics - Time Series Data",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Time series data exists\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.clicksOverTime).to.be.an('array');",
                  "    ",
                  "    if (jsonData.clicksOverTime.length > 0) {",
                  "        var dataPoint = jsonData.clicksOverTime[0];",
                  "        pm.expect(dataPoint).to.have.property('date');",
                  "        pm.expect(dataPoint).to.have.property('count');",
                  "    }",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/analytics/{{short_code}}",
              "host": ["{{base_url}}"],
              "path": ["api", "analytics", "{{short_code}}"]
            }
          }
        }
      ]
    },
    {
      "name": "Phase 2 - Pagination (NEW)",
      "item": [
        {
          "name": "4.1 Get All URLs - Default Pagination",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Response has pagination structure\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('content');",
                  "    pm.expect(jsonData).to.have.property('totalElements');",
                  "    pm.expect(jsonData).to.have.property('totalPages');",
                  "    pm.expect(jsonData).to.have.property('size');",
                  "    pm.expect(jsonData).to.have.property('number');",
                  "    pm.expect(jsonData).to.have.property('first');",
                  "    pm.expect(jsonData).to.have.property('last');",
                  "});",
                  "",
                  "pm.test(\"Default page is 0\", function () {",
                  "    pm.expect(pm.response.json().number).to.eql(0);",
                  "});",
                  "",
                  "pm.test(\"Default size is 10\", function () {",
                  "    pm.expect(pm.response.json().size).to.eql(10);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/urls",
              "host": ["{{base_url}}"],
              "path": ["api", "urls"]
            }
          }
        },
        {
          "name": "4.2 Get URLs - With Analytics Summary",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Each URL has analytics summary\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    if (jsonData.content.length > 0) {",
                  "        var url = jsonData.content[0];",
                  "        pm.expect(url).to.have.property('analyticsSummary');",
                  "        ",
                  "        var analytics = url.analyticsSummary;",
                  "        pm.expect(analytics).to.have.property('totalClicks');",
                  "        pm.expect(analytics).to.have.property('lastClickedAt');",
                  "        pm.expect(analytics).to.have.property('topCountry');",
                  "        pm.expect(analytics).to.have.property('topCountryClicks');",
                  "        pm.expect(analytics).to.have.property('topDeviceType');",
                  "        pm.expect(analytics).to.have.property('topDeviceClicks');",
                  "        pm.expect(analytics).to.have.property('clicksToday');",
                  "        pm.expect(analytics).to.have.property('clicksThisWeek');",
                  "    }",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/urls?page=0&size=10",
              "host": ["{{base_url}}"],
              "path": ["api", "urls"],
              "query": [
                {
                  "key": "page",
                  "value": "0"
                },
                {
                  "key": "size",
                  "value": "10"
                }
              ]
            }
          }
        },
        {
          "name": "4.3 Pagination - Page 1",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Page number is 1\", function () {",
                  "    pm.expect(pm.response.json().number).to.eql(1);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/urls?page=1&size=10",
              "host": ["{{base_url}}"],
              "path": ["api", "urls"],
              "query": [
                {
                  "key": "page",
                  "value": "1"
                },
                {
                  "key": "size",
                  "value": "10"
                }
              ]
            }
          }
        },
        {
          "name": "4.4 Page Size - 5 per page",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Size is 5\", function () {",
                  "    pm.expect(pm.response.json().size).to.eql(5);",
                  "});",
                  "",
                  "pm.test(\"Content has max 5 items\", function () {",
                  "    pm.expect(pm.response.json().content.length).to.be.at.most(5);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/urls?page=0&size=5",
              "host": ["{{base_url}}"],
              "path": ["api", "urls"],
              "query": [
                {
                  "key": "page",
                  "value": "0"
                },
                {
                  "key": "size",
                  "value": "5"
                }
              ]
            }
          }
        },
        {
          "name": "4.5 Page Size - 50 (Max)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Size is 50\", function () {",
                  "    pm.expect(pm.response.json().size).to.eql(50);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/urls?page=0&size=50",
              "host": ["{{base_url}}"],
              "path": ["api", "urls"],
              "query": [
                {
                  "key": "page",
                  "value": "0"
                },
                {
                  "key": "size",
                  "value": "50"
                }
              ]
            }
          }
        },
        {
          "name": "4.6 Page Size - Exceeds Max (capped)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Size is capped at 50\", function () {",
                  "    pm.expect(pm.response.json().size).to.eql(50);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/urls?page=0&size=100",
              "host": ["{{base_url}}"],
              "path": ["api", "urls"],
              "query": [
                {
                  "key": "page",
                  "value": "0"
                },
                {
                  "key": "size",
                  "value": "100"
                }
              ]
            }
          }
        },
        {
          "name": "4.7 Sort - By createdAt DESC",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Results sorted by createdAt descending\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    if (jsonData.content.length > 1) {",
                  "        var first = new Date(jsonData.content[0].createdAt);",
                  "        var second = new Date(jsonData.content[1].createdAt);",
                  "        pm.expect(first.getTime()).to.be.at.least(second.getTime());",
                  "    }",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/urls?page=0&size=10&sortBy=createdAt&sortDir=desc",
              "host": ["{{base_url}}"],
              "path": ["api", "urls"],
              "query": [
                {
                  "key": "page",
                  "value": "0"
                },
                {
                  "key": "size",
                  "value": "10"
                },
                {
                  "key": "sortBy",
                  "value": "createdAt"
                },
                {
                  "key": "sortDir",
                  "value": "desc"
                }
              ]
            }
          }
        },
        {
          "name": "4.8 Sort - By clickCount DESC",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Results sorted by clickCount descending\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    if (jsonData.content.length > 1) {",
                  "        pm.expect(jsonData.content[0].clickCount).to.be.at.least(jsonData.content[1].clickCount);",
                  "    }",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/urls?page=0&size=10&sortBy=clickCount&sortDir=desc",
              "host": ["{{base_url}}"],
              "path": ["api", "urls"],
              "query": [
                {
                  "key": "page",
                  "value": "0"
                },
                {
                  "key": "size",
                  "value": "10"
                },
                {
                  "key": "sortBy",
                  "value": "clickCount"
                },
                {
                  "key": "sortDir",
                  "value": "desc"
                }
              ]
            }
          }
        },
        {
          "name": "4.9 Recent URLs - Default",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Results sorted newest first\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    if (jsonData.content.length > 1) {",
                  "        var first = new Date(jsonData.content[0].createdAt);",
                  "        var second = new Date(jsonData.content[1].createdAt);",
                  "        pm.expect(first.getTime()).to.be.at.least(second.getTime());",
                  "    }",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/urls/recent",
              "host": ["{{base_url}}"],
              "path": ["api", "urls", "recent"]
            }
          }
        },
        {
          "name": "4.10 Recent URLs - Custom Size",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Size is 5\", function () {",
                  "    pm.expect(pm.response.json().size).to.eql(5);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/urls/recent?page=0&size=5",
              "host": ["{{base_url}}"],
              "path": ["api", "urls", "recent"],
              "query": [
                {
                  "key": "page",
                  "value": "0"
                },
                {
                  "key": "size",
                  "value": "5"
                }
              ]
            }
          }
        },
        {
          "name": "4.11 Legacy Endpoint - No Pagination",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Response is array (not paginated)\", function () {",
                  "    pm.expect(pm.response.json()).to.be.an('array');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/urls/all",
              "host": ["{{base_url}}"],
              "path": ["api", "urls", "all"]
            }
          }
        }
      ]
    },
    {
      "name": "Edge Cases & Error Handling",
      "item": [
        {
          "name": "5.1 Pagination - Negative Page",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Page corrected to 0\", function () {",
                  "    pm.expect(pm.response.json().number).to.eql(0);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/urls?page=-1&size=10",
              "host": ["{{base_url}}"],
              "path": ["api", "urls"],
              "query": [
                {
                  "key": "page",
                  "value": "-1"
                },
                {
                  "key": "size",
                  "value": "10"
                }
              ]
            }
          }
        },
        {
          "name": "5.2 Pagination - Zero Size",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Size corrected to 1\", function () {",
                  "    pm.expect(pm.response.json().size).to.eql(1);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/urls?page=0&size=0",
              "host": ["{{base_url}}"],
              "path": ["api", "urls"],
              "query": [
                {
                  "key": "page",
                  "value": "0"
                },
                {
                  "key": "size",
                  "value": "0"
                }
              ]
            }
          }
        },
        {
          "name": "5.3 Pagination - Page Beyond Total",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Content is empty\", function () {",
                  "    pm.expect(pm.response.json().content).to.be.an('array').that.is.empty;",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/urls?page=9999&size=10",
              "host": ["{{base_url}}"],
              "path": ["api", "urls"],
              "query": [
                {
                  "key": "page",
                  "value": "9999"
                },
                {
                  "key": "size",
                  "value": "10"
                }
              ]
            }
          }
        },
        {
          "name": "5.4 Analytics - No Clicks",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Empty analytics returned\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.totalClicks).to.eql(0);",
                  "    pm.expect(jsonData.clicksByCountry).to.be.an('array').that.is.empty;",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/api/analytics/{{custom_alias_code}}",
              "host": ["{{base_url}}"],
              "path": ["api", "analytics", "{{custom_alias_code}}"]
            }
          }
        }
      ]
    }
  ]
}
